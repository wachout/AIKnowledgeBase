# -*- coding: utf-8 -*-
"""
第三层具像化层 - 约束与准则

数字化、具像化输出必须符合：
- 现实世界的物理、化学、生物、医学、法律等常识和定律
- 第一性原理、物理守恒、材料属性约束、制造边界、环境适应、安全与冗余标准
"""

# 具像化时必须遵守的约束类别与说明（供 prompt 使用）
CONCRETIZATION_CONSTRAINTS = """
## 必须遵守的约束与准则

### 1. 第一性原理
- 从基本事实与定律出发推导，不依赖经验公式时需说明假设
- 明确区分「定义」「定律」「推论」「经验关系」

### 2. 物理守恒
- 质量守恒、能量守恒、动量守恒、电荷守恒
- 热力学第一、第二定律；不可逆过程的熵增

### 3. 材料属性约束
- 材料强度、刚度、密度、热膨胀、导电/绝缘、耐腐蚀等需在合理范围
- 引用具体材料时需注明牌号或典型参数范围

### 4. 制造边界
- 加工精度、工艺可行性（可制造性、可装配性）
- 成本与批量、供应链可得性

### 5. 环境适应
- 工作温度、湿度、振动、电磁兼容、寿命与老化
- 符合适用国标/行标/环保要求

### 6. 安全与冗余标准
- 人身安全、功能安全（如 SIL/ASIL 等级）
- 冗余与容错、失效模式与防护措施
"""

# 领域与常见约束的映射（用于按领域强调）
DOMAIN_CONSTRAINT_HINTS = {
    "物理": "守恒律、量纲一致性、量级估计",
    "化学": "反应计量、平衡、毒性与防护",
    "生物": "生理兼容、代谢、伦理与法规",
    "医学": "临床证据、伦理、药监与临床路径",
    "法律": "适用法域、条文引用、合规义务",
    "机械": "强度、刚度、制造工艺、公差",
    "电气": "绝缘、接地、EMC、安全间距",
    "软件": "可验证性、确定性、安全等级",
    "通用": "第一性原理、守恒、材料与制造边界、环境与安全",
}


def get_constraint_prompt_for_domain(domain: str) -> str:
    """返回该领域需强调的约束说明"""
    hint = DOMAIN_CONSTRAINT_HINTS.get(domain, DOMAIN_CONSTRAINT_HINTS["通用"])
    return f"{CONCRETIZATION_CONSTRAINTS}\n\n**本领域({domain})需特别关注**: {hint}"
